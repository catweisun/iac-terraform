trigger:
  batch: true
  branches:
    include:
    - master
  paths:
    include:
    - /pipelines/*
    exclude:
    - /**/*.md

pr:
  branches:
    include:
    - '*'
  paths:
    include:
    - /pipelines/*
    exclude:
    - /**/*.md

variables:
- group: 'iac-terraform-variables'

stages:
- template: stage-compose.yml
  parameters:
    environments:
    - name: 'devint'
      resourceNameIsolationLevel: 8
  #     enablePrIsolation: true
    - name: 'qa'
      resourceNameIsolationLevel: 8
  #     enablePrIsolation: true
      
    configurations:
    - jobName: main
      terraformTemplatePath: '$(TF_DEPLOYMENT_TEMPLATE_ROOT)'
      deploymentTimeoutInMinutes: 120



    configurationMatrix:
    - jobName: simpleweb
      terraformTemplatePath: 'samples/simpleweb'
      terraformWorkspacePrefix: 'sw'
      environmentsToTeardownAfterRelease:
      - 'devint'

     - jobName: webdata
      terraformTemplatePath: 'samples/webdata'
      terraformWorkspacePrefix: 'wd'
      environmentsToTeardownAfterRelease:
      - 'devint'