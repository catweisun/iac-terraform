# Required Group Variables - iac-terraform-variables
  # AGENT_POOL  (iac-terraform)
  # BUILD_ARTIFACT_NAME  (iac-terraform)
  # FORCE_RUN (false)
  # SERVICE_CONNECTION_NAME  <your_service_connection_name>
  # REMOTE_STATE_ACCOUNT <your_remote_state_account_name>
  # REMOTE_STATE_CONTAINER <your_remote_state_container_name>


trigger:
  batch: true
  branches:
    include:
    - master
  paths:
    include:
    - azure-pipeline.yml
    - /pipelines/*
    - /modules/*
    exclude:
    - /**/*.md

pr:
  branches:
    include:
    - '*'
  paths:
    include:
    - /pipelines/*
    exclude:
    - /**/*.md

variables:
- name: 'TF_VERSION'
  value: '0.12.20'
- name: 'GO_VERSION'
  value: '1.12.14'
- name: 'TF_ROOT_DIR'
  value: 'samples'
- name: 'PIPELINE_ROOT_DIR'
  value: 'pipelines'
- group: 'iac-terraform-variables'

stages:
- template: pipelines/compose-stages.yml
  parameters:
    environments:
    - name: 'dev'
      resourceNameIsolationLevel: 8
      enablePrIsolation: false
      skipTests: false

    configurations:
    - jobName: simpleweb
      terraformWorkspacePrefix: 'sw'
      terraformTemplatePath: 'samples/simpleweb'
      terraformModulePath: 'modules'
      deploymentTimeoutInMinutes: 20
      environmentsToTeardownAfterRelease:
      - 'dev'
